<html>
<head>
    <title>B·∫£ng th√¥ng tin | D∆∞∆°ng Th√°i B·∫£o - IUH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
	@keyframes spin {
		0% { transform: rotate(0deg); }
		100% { transform: rotate(360deg); }
	}
	.animate-spin {
		animation: spin 1s linear infinite;
	}
    .nav{
        top: 0;
        width: 100%;
    }
    body{
        display: flex;
        flex-direction: column;
        min-height: 100dvh;
    }

    .main{
        flex: 1;
    }
</style>

<div type="variable" name="version" value="1.1.9"></div>

<body class="bg-gray-100 font-sans">
    <!-- Navbar -->
    <div class="flex justify-between items-center bg-gray-700 text-white px-8 py-3 nav">
        <div>
            <a href="https://dtbao.io.vn" class="text-lg font-semibold hover:underline">
                <img src="images/avt-40x40.jpg" alt="Profile picture of Bao Duong" class="rounded-full">
            </a>
        </div>
        <div>
            <h3 class="text-xl md:text-2xl font-bold">B·∫¢NG TH√îNG TIN (V<script>document.write(document.querySelector("div[type='variable'][name='version']").getAttribute("value"))</script>)</h3>
        </div>
        <div>
        </div>
    </div>

    <!-- Input secret code-->
     
    <div class="mt-8 markdown main hidden" id="input-code">
        <div class="max-w-xl mx-auto bg-white rounded-lg shadow p-4 mb-6">
            <div class="font-semibold text-red-500">‚ùó Vui l√≤ng nh·∫≠p m√£ c·ªßa d·ª± √°n ƒë·ªÉ ti·∫øp t·ª•c:</div>
            <form action="#" class="flex flex-col p-4 w-full">
                <p for="code" class="text-sm font-semibold text-gray-700 mb-2 mt-4">M√£ d·ª± √°n:</p>
                <input type="text" name="id" class="w-full p-2 border border-gray-300 rounded-md" placeholder="Nh·∫≠p m√£ d·ª± √°n">
                <button type="submit" class="bg-blue-500 text-white p-2 rounded-md mt-6 w-full">X√°c nh·∫≠n</button>
            </form>
        </div>
    </div>

    <div class="mt-8 markdown main" id="posts">

        	<!-- Loading -->
		<div id="loading" class="text-center p-4">
			<svg class="animate-spin h-6 w-6 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
				<circle cx="12" cy="12" r="10" stroke-width="4" class="text-blue-500 opacity-25" />
				<path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke="currentColor" stroke-width="4" class="text-blue-500" />
			<span>ƒêang t·∫£i n·ªôi dung, vui l√≤ng ch·ªù...</span>
		</div>
            <!-- 
        <div class="max-w-xl mx-auto bg-white rounded-lg shadow p-4 mb-6">
            <div class="text-sm font-semibold text-red-500">‚ùó IMPORTANT</div>
            <div class="flex items-start space-x-4 p-4">
                <a href="https://dtbao.io.vn?s=bangthongtin" target="_blank" ><img src="images/avt-40x40.jpg" alt="Profile picture of Bao Duong" class="rounded-full"></a>
                <div>
                    <div class="text-sm font-semibold text-blue-500 hover:underline"><a href="https://dtbao.io.vn?s=bangthongtin" target="_blank" >Bao Duong</a></div>
                    <div class="text-xs text-gray-500">December 20, 2023 ¬∑ <i class="fas fa-globe-asia"></i></div>
                    <div class="text-sm mt-2">
                        N·ªôi dung tu·∫ßn n√†y:<br>
                        Xin ch√†o Hellooo<br>
                        Allo
                    </div>
                </div>
            </div><div class="flex justify-end">
                <div class="text-xs text-gray-500">...</div>
            </div> 
        </div>
        -->
        
    </div>

    
    <div class="text-center flex flex-row aligns-center justify-center mb-8 hidden" id="sec-offset">
        <div class="text-gray-700 me-2">Trang</div>
        <ol class="flex gap-2" id="page-offset">
        </ol>
    </div>

    <!-- footer -->
    <div class="bg-gray-700 text-white text-center py-4 footer">
        <div>
            <p class="text-sm">¬© <script>document.write(new Date().getFullYear())</script> Trang ƒë∆∞·ª£c thi·∫øt k·∫ø v√† x√¢y d·ª±ng b·ªüi D∆∞∆°ng Th√°i B·∫£o - IUH<br>M·ªçi h√†nh vi sao ch√©p √Ω t∆∞·ªüng ƒë·ªÅu l√† vi ph·∫°m b·∫£n quy·ªÅn.</p>
        </div>
    </div>
</body>
<script type="text/javascript" src="js/drawdown.js"></script>
  <script type="text/javascript">

    
    const OFFSET = 5;

    //get parameter from url
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    const currentPage = urlParams.get('page') ? urlParams.get('page') : 1;
    
    const API_URL = "<REPLACE_UR_URL_HERE>";
    const offset = (currentPage - 1) * OFFSET;


    // scroll
    window.onscroll = function() {scrollFunction()};
    function scrollFunction() {
        if (document.body.scrollTop > 50 || document.documentElement.scrollTop > 50) {
            document.getElementsByClassName("nav")[0].style.position = "fixed";
        } else {
            document.getElementsByClassName("nav")[0].style.position = "unset";
        }
    }
    

    function applyMarkdownStyles(styles, parentElement) {
        for (const [selector, classList] of Object.entries(styles)) {
            if (typeof selector === 'string' && Array.isArray(classList)) {
                // Ch·ªâ √°p d·ª•ng class cho c√°c ph·∫ßn t·ª≠ con trong parentElement
                parentElement.querySelectorAll(selector).forEach(el => el.classList.add(...classList));
            } else {
                console.warn(`Invalid selector or classList for: ${selector}`);
            }
        }
        return parentElement.outerHTML;
    }


    // ƒê·ªãnh nghƒ©a c√°c style cho c√°c ph·∫ßn t·ª≠ Markdown
    const markdownStyles = {
        'h1': ['text-3xl', 'font-bold', 'text-blue-600', 'mt-6', 'mb-4'],
        'h2': ['text-2xl', 'font-semibold', 'text-blue-500', 'mt-5', 'mb-3'],
        'h3': ['text-xl', 'font-medium', 'text-blue-400', 'mt-4', 'mb-2'],
        'p': ['text-base', 'text-gray-700', 'mt-2', 'mb-4', 'leading-relaxed'],
        'ul': ['list-disc', 'list-inside', 'pl-5', 'mt-2', 'mb-4'],
        'ol': ['list-decimal', 'list-inside', 'pl-5', 'mt-2', 'mb-4'],
        'li': ['text-gray-700', 'mb-2'],
        'a': ['text-blue-500', 'hover:underline'],
        'code': ['bg-gray-100', 'text-red-500', 'font-mono', 'px-1', 'py-0.5', 'rounded'],
        'pre': ['bg-gray-900', 'text-white', 'p-4', 'rounded-md', 'overflow-x-auto', 'my-4'],
        'blockquote': ['border-l-4', 'border-blue-300', 'pl-4', 'italic', 'text-gray-600', 'my-4']
    };


    function createTag(tag, isPinned){
        var tagTrans = "üîî KH√îNG X√ÅC ƒê·ªäNH";
        var classTag = "text-sm font-semibold text-yellow-500";
        switch (tag){
            case "IMPORTANT":
                tagTrans = "‚ö†Ô∏è QUAN TR·ªåNG";
                classTag = "text-sm font-semibold text-yellow-500";
                break;
            case "INFO":
                tagTrans = "‚ÑπÔ∏è TH√îNG TIN";
                classTag = "text-sm font-semibold text-blue-500";
                break;
            case "UPDATE":
                tagTrans = "üîî C·∫¨P NH·∫¨T";
                classTag = "text-sm font-semibold text-yellow-500";
                break;
            case "REQUIRE_ACTION":
                tagTrans = "‚ùó Y√äU C·∫¶U TH·ª∞C HI·ªÜN";
                classTag = "text-sm font-semibold text-red-500";
                break;
            case "ERROR":
                tagTrans = "‚ùó L·ªñI";
                classTag = "text-sm font-semibold text-red-500";
                break;
            default:
                tagTrans = "üîî KH√îNG X√ÅC ƒê·ªäNH";
                classTag = "text-sm font-semibold text-yellow-500";
                break;
        }
        if (isPinned){
            return `<div class='text-sm font-semibold text-red-500'>üìå ƒê∆Ø·ª¢C GHIM (TAG_${tag})</div>`;
        }
        
        return `<div class='${classTag}'>${tagTrans}</div>`;
    }

    function createName(name){
        return "<a href=\"https://dtbao.io.vn?s=bangthongtin\" target=\"_blank\" class='text-sm font-semibold text-blue-500 hover:underline'>" + name + "</a>";
    }

    function createAvatar(avatar){
        return "<a href='" + avatar + "' target='_blank'><img src='images/avt-40x40.jpg' alt='Profile picture of Bao Duong' class='rounded-full'></a>";
    }

    function createDate(date){
        return "<div class='text-xs text-gray-500'>" + date + " ¬∑ <i class='fas fa-globe-asia'></i></div>";
    }

    function createContent(content){
        const div = document.createElement('div');
        div.innerHTML =  markdown(content);

        div.classList.add('mt-2');
        return applyMarkdownStyles(markdownStyles, div);
    }

    function createPostElement(tag, name, avatar, date, content, isPinned){
        return createTag(tag, isPinned) + "<div class='flex items-start space-x-4 p-4'>" + createAvatar(avatar) + "<div>" + createName(name) + createDate(date) + createContent(content) + "</div></div>";
    }

    function createPost(tag, name, avatar, date, content, isPinned){
        var post = document.createElement("div");
        post.className = "max-w-xl mx-auto bg-white rounded-lg shadow p-4 mb-6";
        post.innerHTML = createPostElement(tag, name, avatar, date, content, isPinned);
        return post;
    }
    
    function createElementPageOffset(page){
        var li = document.createElement("li");
        li.className = "inline-block";
        var a = document.createElement("a");
       
        // get current page
        const urlParams = new URLSearchParams(window.location.search);

        if (!currentPage || currentPage == page){
            a.href = "#";
        }else { 
            // get current url & params, add page-offset
            var url = new URL(window.location.href);
            url.searchParams.set('page', page);
            a.href = url.href;
            console.log(url.href);
        }
        a.className = "text-blue-500 hover:underline";
        a.innerHTML = page;
        li.appendChild(a);
        return li;
    }

    function getPosts(){
        var posts = document.getElementById("posts");
        fetch(`${API_URL}?id=${id}&offset=${offset}`)
        .then(response => response.json()).then(result => {
        
            document.getElementById("sec-offset").classList.toggle("hidden", false);

            //result.errorCode = 500;
            //result.total = null;
            const totalData = result.total ?? 1;

            const totalPage = totalData % 10 == 0 ? totalData / 10 : Math.floor(totalData / 10) + 1;

            var pageOffset = document.getElementById("page-offset");

            for (var i = 1; i <= totalPage + 1; i++){
                var li = createElementPageOffset(i);
                pageOffset.appendChild(li);
            }

            if (result.errorCode != 200){
                var post = createPost("ERROR", "Bao Duong", "https://dtbao.io.vn?s=bangthongtin", "B√¢y gi·ªù", "Server tr·∫£ l·ªói: " + result.errorCode + " (" + result.message +"). H√£y th·ª≠ l·∫°i l·∫°i trang nh√©!", true);
                posts.appendChild(post);
                return;
            }
            const data = result.data;

            if (data.length == 0){
                var post = createPost("INFO", "Bao Duong", "https://dtbao.io.vn?s=bangthongtin", "B√¢y gi·ªù", "Kh√¥ng c√≥ n·ªôi dung n√†o ƒë∆∞·ª£c ƒëƒÉng t·∫£i ho·∫∑c d·ª± √°n n√†y kh√¥ng t·ªìn t·∫°i!\n\nM√£ d·ª± √°n: `"+ id +"`", true);
                posts.appendChild(post);
                return;
            }
            
            for (var i = 0; i < data.length; i++){
                var post = createPost(data[i].type, "Bao Duong", "https://dtbao.io.vn?s=bangthongtin", data[i].timestamp, data[i].notification, data[i].isPinned ?? false);
                posts.appendChild(post);
            }
        }).catch(error => {
            var post = createPost("ERROR", "Bao Duong", "https://dtbao.io.vn?s=bangthongtin", "B√¢y gi·ªù", "Load n·ªôi dung th·∫•t b·∫°i, h√£y [reload l·∫°i trang]("+ window.location.href.replace("#", "") +"), n·∫øu kh√¥ng ƒë∆∞·ª£c xin h√£y m·ªü b·∫±ng Chrome!\n\nCode d·ª± √°n n·∫øu c·∫ßn: `" + id+"`", true);
            posts.appendChild(post);
            console.log(error);
        }).finally(() => {
            document.getElementById("loading").style.display = "none";
        });
    }

    window.onload = ()=> {
        if (!id || id == "" || id.trim() == ""){
            document.getElementById("input-code").classList.toggle("hidden", false);
            document.getElementById("loading").style.display = "none";
            return;
        } else {
            getPosts();
        }
        
    };
  </script>
</html>